<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LernWerkstatt</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin:0; background:#f6f7fb; color:#111; }
    .wrap { max-width: 1100px; margin:0 auto; padding:24px; }
    .card { background:#fff; border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.08); margin-top:14px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .top { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    h1 { margin:0; font-size:1.8rem; }
    .muted { opacity:.8; }
    .pill { padding:8px 12px; border-radius:999px; background:#eef2ff; font-weight:900; }
    .btn {
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 14px; border-radius:12px;
      border:0; cursor:pointer; font-weight:900;
      background:#1f6feb; color:#fff; text-decoration:none;
    }
    .btn.ghost { background:#e5e7eb; color:#111; }
    .btn.dark { background:#111827; color:#fff; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:14px; margin-top:14px; }
    .tile { background:#fff; border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.06); border:1px solid #e5e7eb; }
    .tile h2 { margin:0 0 8px; font-size:1.2rem; }
    .tile p { margin:0 0 12px; }
    .tile .row { justify-content:flex-start; }
    .logoBox { display:flex; align-items:center; gap:12px; }
    .logo { width:56px; height:56px; flex:0 0 auto; }
    footer { margin-top:16px; font-size:.9rem; opacity:.75; }
  </style>
</head>
<body>
  <div class="wrap">

    <div class="card">
      <div class="top">
        <div class="logoBox">
          <!-- Logo als SVG (keine extra Datei notwendig) -->
          <svg class="logo" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" aria-label="LernWerkstatt Logo">
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#1f6feb"/>
                <stop offset="1" stop-color="#111827"/>
              </linearGradient>
            </defs>
            <rect x="10" y="10" width="108" height="108" rx="26" fill="url(#g)"/>
            <!-- Buch -->
            <path d="M34 42c0-4 3-7 7-7h26c7 0 13 3 17 8v52c-4-5-10-8-17-8H41c-4 0-7-3-7-7V42z"
                  fill="#ffffff" opacity="0.95"/>
            <path d="M94 42c0-4-3-7-7-7H61c-7 0-13 3-17 8v52c4-5 10-8 17-8h26c4 0 7-3 7-7V42z"
                  fill="#ffffff" opacity="0.85"/>
            <!-- Zahnrad (Werkstatt) -->
            <path d="M64 54l4 2 4-2 4 3-1 4 3 3 4-1 3 4-2 4 2 4-3 4-4-1-3 3 1 4-4 3-4-2-4 2-4-3 1-4-3-3-4 1-3-4 2-4-2-4 3-4 4 1 3-3-1-4 4-3z"
                  fill="#111827" opacity="0.25"/>
            <circle cx="64" cy="70" r="7" fill="#111827" opacity="0.35"/>
          </svg>

          <div>
            <h1>LernWerkstatt</h1>
            <div class="muted">Übersicht der Fächer & Spiele</div>
          </div>
        </div>

        <div class="row">
          <div class="pill">Aktive Nutzer: <span id="activeCount">–</span></div>
          <a class="btn ghost" href="./lehrer.html">Lehrerbereich</a>
          <a class="btn dark" href="./admin.html">Adminbereich</a>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="tile">
        <h2>Mathematik</h2>
        <p class="muted">Einmaleins-Training (120s) – mit Schülercode-Login</p>
        <div class="row">
          <a class="btn" href="./mathematik.html">Mathe-Spiel starten</a>
        </div>
      </div>

      <div class="tile">
        <h2>Digitale Bildung</h2>
        <p class="muted">Binärsystem & weitere Spiele</p>
        <div class="row">
          <a class="btn" href="./BinaerPro.html">BinärPro</a>
          <a class="btn ghost" href="./spiel1.html">Spiel 1</a>
          <a class="btn ghost" href="./spiel2.html">Spiel 2</a>
        </div>
      </div>

      <div class="tile">
        <h2>Technisches Seminar</h2>
        <p class="muted">Platzhalter – hier können später weitere Inhalte rein</p>
        <div class="row">
          <a class="btn ghost" href="./technik.html">Zur Übersicht</a>
        </div>
      </div>
    </div>

    <footer class="muted">
      Hinweis: Die „Aktive Nutzer“-Anzeige zählt alle offenen Seiten, die den Presence-Code enthalten.
    </footer>

  </div>

  <!-- Active users via Supabase Realtime Presence -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const SUPABASE_URL = "https://dnlencbwbbriijmzijci.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_G8SaY8-oyn7TcP-uH6neuA_PNqUR1x0";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // stabiler Key pro Tab
    const tabId = crypto.randomUUID();

    const activeCountEl = document.getElementById("activeCount");

    function countPresence(presenceState) {
      // presenceState: { key1: [meta], key2: [meta], ... }
      return Object.keys(presenceState || {}).length;
    }

    const channel = supabase.channel("lw-active", {
      config: { presence: { key: tabId } }
    });

    channel.on("presence", { event: "sync" }, () => {
      const state = channel.presenceState();
      activeCountEl.textContent = String(countPresence(state));
    });

    channel.on("presence", { event: "join" }, () => {
      const state = channel.presenceState();
      activeCountEl.textContent = String(countPresence(state));
    });

    channel.on("presence", { event: "leave" }, () => {
      const state = channel.presenceState();
      activeCountEl.textContent = String(countPresence(state));
    });

    await channel.subscribe(async (status) => {
      if (status === "SUBSCRIBED") {
        // Meta-Info optional
        await channel.track({ page: "index", t: Date.now() });
        const state = channel.presenceState();
        activeCountEl.textContent = String(countPresence(state));
      }
    });

    // Cleanup
    window.addEventListener("beforeunload", () => {
      try { supabase.removeChannel(channel); } catch {}
    });
  </script>
</body>
</html>
