<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spiel 1 ‚Äì Bin√§r-Quest (Random)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #f6f7fb; color: #111; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
    header { display: flex; gap: 16px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    h1 { margin: 0; font-size: 1.35rem; }
    h2 { margin: 0 0 10px; font-size: 1.15rem; }
    .card { background: #fff; border-radius: 14px; padding: 18px; box-shadow: 0 8px 24px rgba(0,0,0,.08); }
    .row { display: flex; gap: 14px; flex-wrap: wrap; align-items: center; }
    .pill { padding: 6px 10px; border-radius: 999px; background: #eef2ff; font-weight: 700; }
    .question { font-size: 1.2rem; margin: 8px 0 12px; }
    .hint { margin: 0 0 14px; color: #333; opacity: .85; }
    input[type="text"], input[type="password"], textarea{
      font-size: 1.0rem; padding: 10px 12px; border-radius: 10px;
      border: 1px solid #ccd2e1;
    }
    input[type="text"], input[type="password"]{ min-width: 240px; }
    textarea{ width: 100%; min-height: 260px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    button{
      padding: 10px 14px; border-radius: 10px; border: 0;
      background: #1f6feb; color: #fff; font-weight: 800; cursor: pointer;
    }
    button.secondary{ background: #111827; }
    button.ghost{ background: #e5e7eb; color: #111; }
    button:disabled{ opacity: .55; cursor: not-allowed; }
    .feedback{ margin-top: 12px; padding: 12px; border-radius: 10px; }
    .ok{ background: #ecfdf5; border: 1px solid #10b98144; }
    .bad{ background: #fef2f2; border: 1px solid #ef444444; }
    .small{ font-size: .92rem; opacity: .88; }
    .muted{ opacity: .75; }
    code.kbd { background: #111827; color: #fff; padding: 2px 6px; border-radius: 6px; }
    .grid { display: grid; gap: 14px; grid-template-columns: 1fr; }
    @media (min-width: 900px){ .grid { grid-template-columns: 1.25fr .75fr; } }
    .tag { display:inline-block; font-size:.85rem; padding: 2px 8px; border-radius:999px; background:#f3f4f6; }
    .danger { background:#fee2e2; color:#111; padding:6px 10px; border-radius:10px; }
    .success { background:#dcfce7; color:#111; padding:6px 10px; border-radius:10px; }
    ul { margin: 10px 0 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Bin√§r-Quest üß†‚ö° (Random)</h1>
      <div class="row" id="statusBar" style="display:none;">
        <div class="pill">Name: <span id="playerNameTop">‚Äî</span></div>
        <div class="pill">Frage: <span id="qIndex">1</span>/<span id="qTotal">10</span></div>
        <div class="pill">Punkte: <span id="score">0</span></div>
      </div>
    </header>

    <div class="grid" style="margin-top:14px;">
      <!-- LEFT -->
      <div>
        <div class="card" id="introCard">
          <div class="row" style="justify-content:space-between;">
            <h2 style="margin:0;">Kurze Erkl√§rung: Bin√§rsystem</h2>
            <div class="row">
              <a href="./index.html" class="ghost"
                 style="text-decoration:none; padding:10px 14px; border-radius:10px; background:#e5e7eb; color:#111; font-weight:800;">
                ‚Üê Startseite
              </a>
              <button id="openTeacherBtn" class="ghost">Lehrermodus</button>
            </div>
          </div>

          <p>
            Im <strong>Bin√§rsystem</strong> gibt es nur <code class="kbd">0</code> und <code class="kbd">1</code>.
            Jede Stelle hat einen <strong>Stellenwert</strong> (von rechts): 1, 2, 4, 8, 16, 32, 64, ‚Ä¶
          </p>
          <p class="small">
            Eine <code class="kbd">1</code> bedeutet: ‚ÄûDiesen Stellenwert mitz√§hlen‚Äú. Eine <code class="kbd">0</code> bedeutet: ‚ÄûNicht mitz√§hlen‚Äú.
          </p>

          <div class="card" style="box-shadow:none; border:1px solid #e5e7eb; margin-top:12px;">
            <strong>Beispiele (kommen NICHT im Quiz vor):</strong>
            <ul>
              <li><code class="kbd">7</code> (dezimal) = <code class="kbd">111</code> (bin√§r) ‚Üí 4 + 2 + 1 = 7</li>
              <li><code class="kbd">20</code> (dezimal) = <code class="kbd">10100</code> (bin√§r) ‚Üí 16 + 4 = 20</li>
              <li><code class="kbd">100100</code> (bin√§r) = <code class="kbd">36</code> (dezimal) ‚Üí 32 + 4 = 36</li>
            </ul>
            <p class="small muted" style="margin:10px 0 0;">
              F√ºhrende Nullen √§ndern den Wert nicht: <code class="kbd">101</code> = <code class="kbd">00000101</code>.
            </p>
          </div>

          <div class="row" style="margin-top:14px;">
            <label class="small"><strong>Name:</strong></label>
            <input id="nameInput" type="text" maxlength="20" placeholder="z.B. Alex" />
            <button id="startBtn">Spiel starten</button>
          </div>

          <p class="small muted" style="margin-top:10px;">
            Punkte-Regel: Pro Frage gibt‚Äôs nur dann einen Punkt, wenn du sie <strong>beim 1. Versuch</strong> richtig l√∂st.
            Nach einem Fehler darfst du weiter probieren, bekommst aber f√ºr diese Frage dann <strong>keinen Punkt mehr</strong>.
          </p>
        </div>

        <div class="card" id="teacherCard" style="display:none; margin-top:14px;">
          <div class="row" style="justify-content:space-between;">
            <h2 style="margin:0;">Lehrermodus</h2>
            <button id="closeTeacherBtn" class="ghost">Schlie√üen</button>
          </div>

          <p class="small muted" style="margin-top:8px;">
            Hier stellst du die Random-Generierung ein. √Ñnderungen werden im Browser gespeichert (dieses Ger√§t).
          </p>

          <div id="teacherLocked">
            <div class="row">
              <input id="teacherPin" type="password" placeholder="PIN eingeben" />
              <button id="unlockTeacherBtn">Entsperren</button>
            </div>
            <p class="small muted" style="margin-top:8px;">
              PIN im Code oben √§ndern: <code class="kbd">TEACHER_PIN</code>
            </p>
          </div>

          <div id="teacherUnlocked" style="display:none;">
            <div class="card" style="box-shadow:none; border:1px solid #e5e7eb;">
              <div class="row" style="justify-content:space-between;">
                <strong>Einstellungen (JSON)</strong>
                <span class="tag">Random-Quiz</span>
              </div>
              <p class="small muted" style="margin:8px 0 10px;">
                Hinweise werden bis inkl. <code class="kbd">hintsUntilQuestion</code> angezeigt (z.B. 3). Ab der n√§chsten Frage sind sie weg.
              </p>
              <textarea id="teacherJson"></textarea>
              <div class="row" style="margin-top:10px;">
                <button id="saveTeacherBtn" class="secondary">Speichern</button>
                <button id="resetTeacherBtn" class="ghost">Standard</button>
                <span id="teacherMsg" class="small muted"></span>
              </div>
            </div>
          </div>
        </div>

        <div class="card" id="gameCard" style="display:none; margin-top:14px;">
          <div class="question" id="questionText">‚Ä¶</div>
          <p class="hint" id="hintText">‚Ä¶</p>

          <div class="row">
            <input id="answerInput" type="text" inputmode="numeric" autocomplete="off" placeholder="Antwort‚Ä¶" />
            <button id="checkBtn">Pr√ºfen</button>
            <button id="nextBtn" class="secondary" disabled>Weiter ‚ñ∂</button>
            <button id="restartBtn" class="ghost" title="Neustart">Neu starten</button>
          </div>

          <div id="feedback" class="feedback" style="display:none;"></div>
          <p class="small muted" style="margin-top:12px;">
            Tipp: Bin√§r nur 0/1 (f√ºhrende Nullen ok). Dezimal nur Ziffern.
          </p>
        </div>

        <div class="card" id="resultCard" style="display:none; margin-top:14px;">
          <h2>Ergebnis</h2>
          <p id="resultText" style="font-size:1.05rem; margin:0 0 12px;"></p>
          <div id="review"></div>
          <div class="row" style="margin-top:12px;">
            <button id="playAgainBtn" class="secondary">Nochmal spielen</button>
            <a href="./index.html" class="ghost"
               style="text-decoration:none; padding:10px 14px; border-radius:10px; background:#e5e7eb; color:#111; font-weight:800;">
              ‚Üê Startseite
            </a>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <h2 style="margin:0;">Einstellungen (Kurz)</h2>
          <span class="tag">Lehrermodus</span>
        </div>
        <p class="small muted" style="margin:8px 0 0;">
          Du kannst im Lehrermodus z.B. die Anzahl der Fragen, den Zahlenbereich und ab wann Hinweise verschwinden einstellen.
        </p>
        <ul class="small muted">
          <li><strong>Fragen:</strong> <span id="cfgQuestions">10</span></li>
          <li><strong>Hinweise bis:</strong> Frage <span id="cfgHints">3</span></li>
          <li><strong>Max Bits (letzte Fragen):</strong> <span id="cfgBits">8</span></li>
          <li><strong>Mix:</strong> <span id="cfgMix">50%</span> Dez‚ÜíBin</li>
        </ul>
      </div>
    </div>
  </div>

<script>
(() => {
  // ===========================
  // Lehr-PIN (hier √§ndern)
  // ===========================
  const TEACHER_PIN = "1234";

  // ===========================
  // Default Random-Config
  // ===========================
  const DEFAULT_CONFIG = {
    totalQuestions: 10,

    // ab Frage 4 keine Hinweise => 3
    hintsUntilQuestion: 3,

    // Anteil Dezimal->Bin√§r (0..1). 0.5 = Mischung
    dec2binRatio: 0.5,

    // Schwierigkeit: wir steigern Bits von minBits -> maxBits √ºber alle Fragen
    minBits: 3,    // fr√ºhe Fragen (z.B. bis 7)
    maxBits: 8,    // sp√§tere Fragen (z.B. bis 255)

    // verhindert doppelte Zahlen im selben Durchgang
    avoidDuplicates: true
  };

  const CFG_KEY = "binaerquest_random_config_v1";
  function loadConfig() {
    try {
      const raw = localStorage.getItem(CFG_KEY);
      const cfg = raw ? JSON.parse(raw) : null;
      if (!cfg) return structuredClone(DEFAULT_CONFIG);
      return { ...structuredClone(DEFAULT_CONFIG), ...cfg };
    } catch { return structuredClone(DEFAULT_CONFIG); }
  }
  function saveConfig(cfg) { localStorage.setItem(CFG_KEY, JSON.stringify(cfg)); }

  let config = loadConfig();

  // ===========================
  // Helpers
  // ===========================
  const decToBin = (n) => n.toString(2);
  const binToDec = (b) => parseInt(b, 2);
  const normalizeBinary = (s) => s.replace(/\s+/g, "");
  const normalizeNumber = (s) => s.trim();
  const isValidBinary = (s) => /^[01]+$/.test(s);
  const isValidDecimal = (s) => /^\d+$/.test(s);
  const escapeHtml = (s) => String(s).replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[c]));

  function clampInt(x, min, max) {
    x = Number(x);
    if (!Number.isFinite(x)) return min;
    x = Math.floor(x);
    return Math.max(min, Math.min(max, x));
  }

  function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // Schwierigkeit pro Frage: Bits interpolieren
  function bitsForQuestion(qIndex1Based, total, minBits, maxBits) {
    if (total <= 1) return maxBits;
    const t = (qIndex1Based - 1) / (total - 1); // 0..1
    const bits = Math.round(minBits + t * (maxBits - minBits));
    return clampInt(bits, 1, 16);
  }

  function makeHintForDec2Bin(n) {
    // kleine, kindgerechte Hilfen: "n = ... + ..."
    // Wir nehmen eine Zerlegung in 2er-Potenzen:
    const parts = [];
    let remaining = n;
    let p = 1;
    while (p <= remaining) p *= 2;
    p /= 2;
    while (p >= 1) {
      if (remaining >= p) { parts.push(p); remaining -= p; }
      p /= 2;
    }
    return `${n} = ${parts.join(" + ")}`;
  }

  function makeHintForBin2Dec(bin) {
    const bits = bin.length;
    const weights = [];
    for (let i = 0; i < bits; i++) {
      weights.push(Math.pow(2, bits - 1 - i));
    }
    return `Stellenwerte: ${weights.join(",")}`;
  }

  // ===========================
  // Question generation
  // ===========================
  function generateRoundQuestions(cfg) {
    const total = clampInt(cfg.totalQuestions, 1, 50);
    const minBits = clampInt(cfg.minBits, 1, 16);
    const maxBits = clampInt(cfg.maxBits, 1, 16);
    const ratio = Math.max(0, Math.min(1, Number(cfg.dec2binRatio)));
    const avoidDup = !!cfg.avoidDuplicates;

    const usedDec = new Set(); // zur Duplikatsvermeidung (dezimaler Wert)
    const qs = [];

    for (let i = 1; i <= total; i++) {
      const bits = bitsForQuestion(i, total, minBits, maxBits);
      const maxVal = Math.pow(2, bits) - 1;
      const minVal = Math.max(1, Math.pow(2, Math.max(1, bits-1))); // grob: keine zu kleinen Zahlen bei h√∂heren Bits
      const mode = (Math.random() < ratio) ? "dec2bin" : "bin2dec";

      let n, tries = 0;
      do {
        // bei kleinen Bits: lieber auch kleinere Werte zulassen
        const low = bits <= 4 ? 2 : Math.max(2, Math.floor(minVal / 2));
        n = randInt(low, maxVal);
        tries++;
        if (!avoidDup) break;
      } while (usedDec.has(n) && tries < 200);

      usedDec.add(n);

      if (mode === "dec2bin") {
        qs.push({
          type: "dec2bin",
          value: n,
          prompt: `Wandle ${n} in Bin√§r um.`,
          hint: makeHintForDec2Bin(n)
        });
      } else {
        const b = decToBin(n);
        qs.push({
          type: "bin2dec",
          value: b,
          prompt: `Wandle ${b} in Dezimal um.`,
          hint: makeHintForBin2Dec(b)
        });
      }
    }
    return qs;
  }

  // ===========================
  // Answer check (value-based)
  // ===========================
  function isCorrectAnswer(q, raw) {
    if (q.type === "dec2bin") {
      const s = normalizeBinary(raw);
      if (!isValidBinary(s)) return { valid:false };
      return { valid:true, ok: binToDec(s) === Number(q.value) };
    } else {
      const s = normalizeNumber(raw);
      if (!isValidDecimal(s)) return { valid:false };
      return { valid:true, ok: Number(s) === binToDec(String(q.value)) };
    }
  }
  function expectedDisplay(q) {
    return (q.type === "dec2bin") ? decToBin(Number(q.value)) : String(binToDec(String(q.value)));
  }

  // ===========================
  // UI refs
  // ===========================
  const statusBar = document.getElementById("statusBar");
  const playerNameTop = document.getElementById("playerNameTop");
  const qIndexEl = document.getElementById("qIndex");
  const qTotalEl = document.getElementById("qTotal");
  const scoreEl = document.getElementById("score");

  const introCard = document.getElementById("introCard");
  const teacherCard = document.getElementById("teacherCard");
  const teacherLocked = document.getElementById("teacherLocked");
  const teacherUnlocked = document.getElementById("teacherUnlocked");
  const teacherJson = document.getElementById("teacherJson");
  const teacherMsg = document.getElementById("teacherMsg");

  const gameCard = document.getElementById("gameCard");
  const resultCard = document.getElementById("resultCard");

  const nameInput = document.getElementById("nameInput");
  const startBtn = document.getElementById("startBtn");

  const questionTextEl = document.getElementById("questionText");
  const hintTextEl = document.getElementById("hintText");
  const answerInput = document.getElementById("answerInput");
  const checkBtn = document.getElementById("checkBtn");
  const nextBtn = document.getElementById("nextBtn");
  const restartBtn = document.getElementById("restartBtn");
  const feedbackEl = document.getElementById("feedback");

  const resultText = document.getElementById("resultText");
  const reviewEl = document.getElementById("review");
  const playAgainBtn = document.getElementById("playAgainBtn");

  const openTeacherBtn = document.getElementById("openTeacherBtn");
  const closeTeacherBtn = document.getElementById("closeTeacherBtn");
  const teacherPin = document.getElementById("teacherPin");
  const unlockTeacherBtn = document.getElementById("unlockTeacherBtn");
  const saveTeacherBtn = document.getElementById("saveTeacherBtn");
  const resetTeacherBtn = document.getElementById("resetTeacherBtn");

  const cfgQuestions = document.getElementById("cfgQuestions");
  const cfgHints = document.getElementById("cfgHints");
  const cfgBits = document.getElementById("cfgBits");
  const cfgMix = document.getElementById("cfgMix");

  // ===========================
  // State
  // ===========================
  let playerName = "";
  let idx = 0;
  let score = 0;
  let firstTryStillPossible = true;
  let questions = []; // generated per game
  const history = []; // {prompt, correct, user, ok, tries, gotPoint}

  function setFeedback(ok, msg) {
    feedbackEl.style.display = "block";
    feedbackEl.className = "feedback " + (ok ? "ok" : "bad");
    feedbackEl.innerHTML = msg;
  }

  function refreshConfigSummary() {
    cfgQuestions.textContent = String(config.totalQuestions);
    cfgHints.textContent = String(config.hintsUntilQuestion);
    cfgBits.textContent = String(config.maxBits);
    cfgMix.textContent = `${Math.round(Number(config.dec2binRatio) * 100)}%`;
  }

  function currentQuestion() { return questions[idx]; }

  function renderQuestion() {
    qTotalEl.textContent = String(questions.length);
    qIndexEl.textContent = String(idx + 1);
    scoreEl.textContent = String(score);

    const q = currentQuestion();
    questionTextEl.textContent = q.prompt;

    const showHint = (idx + 1) <= Number(config.hintsUntilQuestion);
    if (showHint && q.hint) {
      hintTextEl.style.display = "block";
      hintTextEl.textContent = "Hinweis: " + q.hint;
    } else {
      hintTextEl.style.display = "none";
      hintTextEl.textContent = "";
    }

    feedbackEl.style.display = "none";
    answerInput.value = "";
    answerInput.focus();

    nextBtn.disabled = true;
    checkBtn.disabled = false;
    firstTryStillPossible = true;

    answerInput.placeholder = (q.type === "dec2bin")
      ? "Bin√§r (z.B. 101 oder 00000101)‚Ä¶"
      : "Dezimal (z.B. 10)‚Ä¶";
  }

  function finishGame() {
    gameCard.style.display = "none";
    resultCard.style.display = "block";

    const percent = Math.round((score / questions.length) * 100);
    resultText.textContent = `${playerName}: ${score}/${questions.length} Punkte (${percent}%).`;

    reviewEl.innerHTML = history.map((h, i) => {
      const icon = h.ok ? "‚úÖ" : "‚ùå";
      const pointTxt = h.gotPoint ? " (+1 Punkt)" : " (0 Punkte)";
      return `<div style="margin:6px 0; padding:10px; border-radius:10px; background:#f3f4f6;">
        <strong>${icon} Frage ${i+1}:</strong> ${escapeHtml(h.prompt)}<br/>
        <span class="small">
          Versuche: <strong>${h.tries}</strong>${pointTxt}<br/>
          Deine letzte Antwort: <code class="kbd">${escapeHtml(h.user)}</code> ‚Äî Richtig (eine m√∂gliche Schreibweise): <code class="kbd">${escapeHtml(h.correct)}</code>
        </span>
      </div>`;
    }).join("");
  }

  function checkAnswer() {
    const q = currentQuestion();
    const raw = answerInput.value;

    if (!history[idx]) {
      history[idx] = { prompt: q.prompt, correct: expectedDisplay(q), user: "", ok: false, tries: 0, gotPoint: false };
    }
    const h = history[idx];
    h.tries += 1;

    const res = isCorrectAnswer(q, raw);
    if (!res.valid) {
      setFeedback(false, `‚ö†Ô∏è Bitte g√ºltig eingeben. ${
        q.type === "dec2bin" ? "Bin√§r: nur 0 und 1." : "Dezimal: nur Ziffern."
      }`);
      return;
    }

    h.user = (q.type === "dec2bin") ? normalizeBinary(raw) : normalizeNumber(raw);

    if (res.ok) {
      h.ok = true;
      if (firstTryStillPossible) {
        score += 1;
        h.gotPoint = true;
        setFeedback(true, `‚úÖ Richtig! <strong>+1 Punkt</strong>. (z.B. <code class="kbd">${expectedDisplay(q)}</code>)`);
      } else {
        h.gotPoint = false;
        setFeedback(true, `‚úÖ Richtig! (Nach einem Fehler gibt es f√ºr diese Frage keine Punkte mehr.)`);
      }
      scoreEl.textContent = String(score);
      checkBtn.disabled = true;
      nextBtn.disabled = false;
    } else {
      firstTryStillPossible = false;
      h.ok = false;
      setFeedback(false, `‚ùå Noch nicht. Versuch es nochmal! (F√ºr diese Frage sind jetzt <strong>keine Punkte</strong> mehr m√∂glich.)`);
      answerInput.focus();
      answerInput.select();
      nextBtn.disabled = true;
    }
  }

  function nextQuestion() {
    if (idx < questions.length - 1) {
      idx += 1;
      renderQuestion();
    } else {
      finishGame();
    }
  }

  function startGame() {
    playerName = nameInput.value.trim() || "Unbekannt";
    playerNameTop.textContent = playerName;

    // Reload config (falls Lehrermodus gespeichert hat)
    config = loadConfig();
    refreshConfigSummary();

    // Generate NEW random set each start
    questions = generateRoundQuestions(config);

    introCard.style.display = "none";
    teacherCard.style.display = "none";
    resultCard.style.display = "none";
    gameCard.style.display = "block";
    statusBar.style.display = "flex";

    idx = 0; score = 0; history.length = 0;
    renderQuestion();
  }

  function restartToIntro() {
    statusBar.style.display = "none";
    introCard.style.display = "block";
    gameCard.style.display = "none";
    resultCard.style.display = "none";
  }

  // ===========================
  // Teacher mode
  // ===========================
  function openTeacher() {
    teacherCard.style.display = "block";
    teacherLocked.style.display = "block";
    teacherUnlocked.style.display = "none";
    teacherPin.value = "";
    teacherMsg.textContent = "";
    teacherJson.value = "";
    teacherPin.focus();
  }
  function closeTeacher() { teacherCard.style.display = "none"; }

  function unlockTeacher() {
    if (teacherPin.value !== TEACHER_PIN) {
      teacherMsg.textContent = "‚ùå Falsche PIN.";
      teacherMsg.className = "danger";
      return;
    }
    teacherMsg.textContent = "‚úÖ Entsperrt.";
    teacherMsg.className = "success";
    teacherLocked.style.display = "none";
    teacherUnlocked.style.display = "block";
    teacherJson.value = JSON.stringify(loadConfig(), null, 2);
  }

  function validateConfig(cfg) {
    if (!cfg || typeof cfg !== "object") return "Config ist kein Objekt.";
    const tq = Number(cfg.totalQuestions);
    if (!Number.isFinite(tq) || tq < 1 || tq > 50) return "totalQuestions muss 1..50 sein.";
    const hu = Number(cfg.hintsUntilQuestion);
    if (!Number.isFinite(hu) || hu < 0 || hu > 50) return "hintsUntilQuestion muss 0..50 sein.";
    const r = Number(cfg.dec2binRatio);
    if (!Number.isFinite(r) || r < 0 || r > 1) return "dec2binRatio muss 0..1 sein.";
    const minB = Number(cfg.minBits), maxB = Number(cfg.maxBits);
    if (!Number.isFinite(minB) || !Number.isFinite(maxB) || minB < 1 || maxB < 1 || minB > 16 || maxB > 16) return "minBits/maxBits m√ºssen 1..16 sein.";
    if (minB > maxB) return "minBits darf nicht gr√∂√üer als maxBits sein.";
    return null;
  }

  function saveTeacher() {
    let cfg;
    try { cfg = JSON.parse(teacherJson.value); }
    catch { teacherMsg.textContent = "‚ùå JSON ung√ºltig."; teacherMsg.className = "danger"; return; }

    const err = validateConfig(cfg);
    if (err) { teacherMsg.textContent = "‚ùå " + err; teacherMsg.className = "danger"; return; }

    saveConfig(cfg);
    config = loadConfig();
    refreshConfigSummary();

    teacherMsg.textContent = "‚úÖ Gespeichert.";
    teacherMsg.className = "success";
  }

  function resetTeacher() {
    saveConfig(structuredClone(DEFAULT_CONFIG));
    teacherJson.value = JSON.stringify(loadConfig(), null, 2);
    config = loadConfig();
    refreshConfigSummary();
    teacherMsg.textContent = "‚úÖ Standard geladen.";
    teacherMsg.className = "success";
  }

  // ===========================
  // Events
  // ===========================
  startBtn.addEventListener("click", startGame);
  nameInput.addEventListener("keydown", (e) => { if (e.key === "Enter") startGame(); });

  checkBtn.addEventListener("click", checkAnswer);
  nextBtn.addEventListener("click", nextQuestion);

  restartBtn.addEventListener("click", restartToIntro);
  playAgainBtn.addEventListener("click", restartToIntro);

  answerInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !checkBtn.disabled) checkAnswer();
    else if (e.key === "Enter" && !nextBtn.disabled) nextQuestion();
  });

  openTeacherBtn.addEventListener("click", openTeacher);
  closeTeacherBtn.addEventListener("click", closeTeacher);
  unlockTeacherBtn.addEventListener("click", unlockTeacher);
  teacherPin.addEventListener("keydown", (e) => { if (e.key === "Enter") unlockTeacher(); });
  saveTeacherBtn.addEventListener("click", saveTeacher);
  resetTeacherBtn.addEventListener("click", resetTeacher);

  // Init
  refreshConfigSummary();
})();
</script>
</body>
</html>
